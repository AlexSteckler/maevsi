server {
  listen 8080;

  root /usr/share/nginx/html;

  try_files $uri $uri/index.html $uri/ /404/;

  # account settings must come before account root location due to nginx' regex matching
  location ~ /account/[^/]+/settings {
    rewrite ^/account/([^/]+)/settings/?$ /account/_username_a_za_z_0_9_plus/settings.html break;
  }

  location ~ /account/[^/]+ {
    rewrite ^/account/([^/]+)/?$ /account/_username_a_za_z_0_9_plus.html break;
  }

  location ~ /event/[^/]+/[^/]+ {
    rewrite ^/event/([^/]+)/([^/]+)/?$ /event/_username_a_za_z_0_9_plus/_event_name_a_za_z_0_9_plus.html break;
  }

  location ~ /event-group/[^/]+/[^/]+ {
    rewrite ^/event-group/([^/]+)/([^/]+)/?$ /event-group/_username_a_za_z_0_9_plus/_event_group_name_a_za_z_0_9_plus.html break;
  }

  location = /healthz {
    add_header Content-Type text/plain;
    return 200 'healthz';
  }

  gzip_proxied any;
  gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
